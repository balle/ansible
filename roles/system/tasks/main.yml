---
- include_vars: '{{ ansible_os_family }}.yml'

- name: configure sysctl 
  copy:
    src: '{{ sysctl_config }}'
    dest: '{{ sysctl_config_dest }}'
    owner: 'root'
    group: 'root'
    mode: 0600
  register: sysctl 
  
- name: reload sysctl 
  command: sysctl -p 
  when: sysctl.changed

- name: hide pids from other users 
  blockinfile:
    block: "proc                    /proc                   proc    nosuid,noexec,nodev,hidepid=2 0 0"
    path: /etc/fstab
  when: ansible_os_family == "Debian" or ansible_os_family == "RedHat"

- name: install macchanger
  package:
    name: macchanger 
    state: present 
  register: macchanger
  when: ansible_os_family == "Debian" or ansible_os_family == "RedHat"

- name: configure macchanger 
  copy:
    src: macchanger
    dest: /etc/default/macchanger
    owner: root 
    group: root 
    mode: 0644
  when: ansible_os_family == "Debian"

- name: install snapd
  package: 
    name: snapd
    state: present
  register: snapd_installed

- name: setup snapd 
  command: snap install core 
  when: 
  - snapd_installed.changed
  - ansible_os_family == "Debian" or ansible_os_family == 'RedHat'

- name: install apt-file 
  package:
    name: apt-file 
    state: present 
  register: apt_file
  when: ansible_os_family == "Debian"

- name: init apt-file 
  command: apt-file update 
  when: apt_file.changed 
