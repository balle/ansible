---
- include_vars: '{{ ansible_os_family }}.yml'
  
- name: install gnupg
  package:
    name: 'gnupg'
    state: present

- name: install aide
  package:
    name: 'aide'
    state: present

- name: configure aide
  copy:
    src: "{{ aide_config }}"
    dest: '{{ aide_config_dest }}'
    owner: 'root'
    group: 'root'
    mode: 0600
  register: aide_config

- name: init aide db
  command: aide --init --config {{ aide_config_dest }}
  when: aide_config.changed

- name: install iptables-persistent
  package:
    name: iptables-persistent
    state: present
  when: ansible_os_family == 'Debian'

- name: configure packetfilter
  copy:
    src: '{{ packetfilter_config }}'
    dest: '{{ packetfilter_config_dest }}'
    owner: 'root'
    group: 'root'
    mode: 0600
  when: ansible_os_family != 'Darwin'

- name: configure ipv6 packetfilter
  copy:
    src: '{{ packetfilter_config }}'
    dest: '/etc/iptables/rules.v6'
    owner: 'root'
    group: 'root'
    mode: 0600
  when: ansible_os_family == 'Debian'

- name: Start iptables service
  service:
    name: iptables
    enabled: yes
    state: started
  when: ansible_os_family == 'Debian'

- name: install tiger
  package:
    name: tiger
    state: present
  when: ansible_os_family == 'Debian'

- name: copy tiger config
  copy:
    src: "tigerrc"
    dest: '/etc/tiger/tigerrc'
    owner: 'root'
    group: 'root'
    mode: 0600
  when: ansible_os_family == 'Debian'

- name: copy tiger ignore
  copy:
    src: "tiger.ignore"
    dest: '/etc/tiger/tiger.ignore'
    owner: 'root'
    group: 'root'
    mode: 0600
  when: ansible_os_family == 'Debian'

- name: install apparmor
  package:
    name: "{{ item }}"
  with_items: 
    - apparmor-profiles
    - apparmor-profiles-extra
    - apparmor-utils
    - apparmor-notify
  when: ansible_os_family == 'Debian'
